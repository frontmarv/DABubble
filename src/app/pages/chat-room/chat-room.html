<div class="main-container">
    <header>
        <div class="backdrop" [class.show]="isProfileMenuOpen" (click)="isProfileMenuOpen=false"></div>

        <div class="header-left">
            @if (isMobile() && !isSidebarOpen) {
            <button class="mobile-back-btn icon-btn" type="button" aria-label="Zurück" (click)="goBackToSidebar()">
                <img src="/login/arrow-back.svg" alt="Zurück" />
            </button>
            }
            <img src="/shared/dabubble-logo.svg" alt="DABubble Logo" class="logo" />
            <h2 class="logo-text">DABubble</h2>
        </div>

        <div class="search-bar">
            <input type="text" placeholder="Devspace durchsuchen" />
            <img src="/main-page/search.svg" alt="Suche" />
        </div>

        <div class="user-profile" [class.open]="isProfileMenuOpen" (click)="toggleProfileMenu()">
            <span class="user-name">{{ firebaseService.currentUser()?.firstName }} {{
                firebaseService.currentUser()?.lastName }}</span>
            <img [src]="getAvatarUrl(firebaseService.currentUser()?.avatar)" alt="Profilbild" class="avatar" />
            <span class="status status--online" aria-hidden="true"></span>
            <span class="dropdown-arrow" aria-hidden="true"></span>

            <div class="profile-menu" (click)="$event.stopPropagation()">
                <div (click)="openProfile()">Profil</div>
                <div class="hover" (click)="logOut()">Log out</div>
            </div>
        </div>
    </header>

    <div class="layout" [class.layout--sidebar-closed]="!isSidebarOpen">
        <div class="sidebar-wrapper" [class.sidebar-wrapper--closed]="!isSidebarOpen">
            <app-sidebar (mobileNavigation)="onMobileNavigation()"></app-sidebar>

            <button class="sidebar-toggle" type="button" (click)="toggleSidebar()" [attr.aria-expanded]="isSidebarOpen">
                <span class="sidebar-toggle__text">
                    Workspace-Menü {{ isSidebarOpen ? 'schließen' : 'öffnen' }}
                </span>
                <img class="sidebar-toggle__icon" [class.sidebar-toggle__icon--closed]="!isSidebarOpen"
                    src="/main-page/Group 2.svg" alt="" />
            </button>
        </div>

        <app-chat></app-chat>
        <app-thread-panel></app-thread-panel>
    </div>

    <app-profile-view *ngIf="showUserProfile" [user]="firebaseService.currentUser()" (close)="closeProfile()">
    </app-profile-view>

    @if (displayForeignUserService.showForeignUserProfile()) {
    <app-not-logged-in (close)="closeForeignUserProfile()"></app-not-logged-in>
    }
</div>