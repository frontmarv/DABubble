<div class="profile-backdrop" (click)="closeProfile()">
  <div class="profile-card" (click)="$event.stopPropagation()">

    <ng-container *ngIf="!isEditing">
      <header class="profile-header">
        <h3>Profil</h3>
        <div class="close-btn" (click)="closeProfile()">
          <img src="/main-page/close-button.svg" alt="">
        </div>
      </header>

      <div class="profile-avatar">
        <img [src]="getAvatarUrl(user?.avatar)" referrerpolicy="no-referrer" alt="Profile">
      </div>

      <div class="profile-name-section">
        <div class="name-row">
          <h2>{{ user?.firstName }} {{ user?.lastName }}</h2>
          @if(firebaseService.currentUser()?.firstName !== "Gast") {
          <span class="edit-btn" (click)="editProfile()">Bearbeiten</span>}
        </div>
        <div class="status-row">
          <span class="status-indicator online"></span>
          <span class="status-text online">Aktiv</span>
        </div>
      </div>

      <div class="profile-email-section">
        <div class="email-label">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect width="20" height="16" x="2" y="4" rx="2"></rect>
            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
          </svg>
          <span>E-Mail-Adresse</span>
        </div>
        <a [href]="'mailto:' + user?.email" class="email-link">{{ user?.email }}</a>
      </div>
    </ng-container>

    <ng-container *ngIf="isEditing">
      <header class="profile-header">
        <h3>Dein Profil bearbeiten</h3>
        <div class="close-icon" (click)="closeProfile()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </div>
      </header>

      <div class="profile-avatar">
        <img [src]="getAvatarUrl(user?.avatar)" referrerpolicy="no-referrer">
      </div>

      <div class="edit-form" *ngIf="user">
        <div class="input-container">
          <div class="input-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="8" r="5"></circle>
              <path d="M20 21a8 8 0 1 0-16 0"></path>
            </svg>
            <span class="bold">Vollst√§ndiger Name</span>
          </div>
          <input type="text" [(ngModel)]="fullName" class="inputfield--dialogs"
            placeholder="Vor- und Nachname eingeben">
        </div>
        <p class="error-message">{{errorMessage}}</p>
      </div>

      <div class="edit-actions">
        <button class="btn--secondary" (click)="cancelEdit()">Abbrechen</button>
        <button class="btn--primary" (click)="saveProfile()">Speichern</button>
      </div>
    </ng-container>

  </div>
</div>